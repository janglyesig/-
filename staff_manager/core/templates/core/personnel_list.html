<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì¸ì› ë° íŒ€ ê´€ë¦¬</title>
<style>
    body { font-family: sans-serif; padding: 20px; background: #f4f6f8; margin: 0; }
    .container { width: 98%; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-sizing: border-box; }

    .layout { display: flex; gap: 30px; height: 85vh; }

    /* [ì™¼ìª½] íŒ€ ê´€ë¦¬ */
    .col-left { flex: 0 0 300px; border-right: 1px solid #eee; padding-right: 20px; overflow-y: auto; }
    .team-item { background: #f9f9f9; padding: 12px; margin-bottom: 8px; border-radius: 6px; display: flex; justify-content: space-between; border: 1px solid #eee; align-items: center; }
    .cat-badge { font-size: 0.7em; padding: 3px 6px; border-radius: 4px; color: white; margin-right: 5px; }
    .cat-general { background: #1976d2; } .cat-prep { background: #f57c00; } .cat-religion { background: #7b1fa2; }

    /* [ì˜¤ë¥¸ìª½] ì¸ì› ëª…ë¶€ */
    .col-right { flex: 1; display: flex; flex-direction: column; }

    /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ ë°” (ì¼ê´„ ë°°ì •) */
    .control-bar { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #90caf9; }
    .bulk-action { display: flex; gap: 10px; align-items: center; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
    th { background: #f8f9fa; border-top: 2px solid #ddd; }
    tr:hover { background: #f1f1f1; }

    .input-box { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .btn-blue { background: #1976d2; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }
    .btn-assign { background: #007bff; color: white; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .btn-green { background: #2e7d32; color: white; text-decoration: none; padding: 8px 15px; border-radius: 4px; font-size: 0.9em; }

    input[type="checkbox"] { transform: scale(1.2); cursor: pointer; }
</style>
<script>
    // ì „ì²´ ì„ íƒ ê¸°ëŠ¥
    function toggleAll(source) {
        document.getElementsByName('person_ids').forEach(cb => cb.checked = source.checked);
    }
</script>
</head>
<body>
    <div class="container">
        <a href="{% url 'core:main_hub' %}" style="text-decoration:none; color:#555; font-weight:bold; display:block; margin-bottom:20px;">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

        <div class="layout">
            <div class="col-left">
                <h3 style="margin-top:0;">ğŸ¢ ê³ ì • íŒ€ ëª©ë¡</h3>

                <form action="{% url 'core:create_standing_team' %}" method="post" style="background:#eee; padding:15px; border-radius:8px; margin-bottom:20px;">
                    {% csrf_token %}
                    <div style="margin-bottom:5px;">
                        <select name="category" class="input-box" style="width:100%;">
                            <option value="general">ì¼ë°˜íŒ€</option>
                            <option value="prep">ì¤€ë¹„íŒ€</option>
                            <option value="religion">ì¢…êµíŒ€</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <input type="text" name="name" placeholder="ìƒˆ íŒ€ ì´ë¦„" class="input-box" style="flex:1;" required>
                        <button class="btn-blue">ìƒì„±</button>
                    </div>
                </form>

                {% for team in standing_teams %}
                <div class="team-item">
                    <div>
                        <span class="cat-badge {% if team.category == 'general' %}cat-general{% elif team.category == 'prep' %}cat-prep{% else %}cat-religion{% endif %}">
                            {{ team.get_category_display }}
                        </span>
                        <strong>{{ team.name }}</strong>
                        <span style="font-size:0.8em; color:#666;">({{ team.members.count }}ëª…)</span>
                    </div>
                    <a href="{% url 'core:delete_standing_team' team.pk %}" onclick="return confirm('íŒ€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì†Œì† ì¸ì›ì€ ë¬´ì†Œì†ì´ ë©ë‹ˆë‹¤)')" style="color:red; text-decoration:none; font-weight:bold;">Ã—</a>
                </div>
                {% empty %}
                <p style="color:#999; text-align:center;">ìƒì„±ëœ íŒ€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>

            <div class="col-right">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h2 style="margin:0;">ğŸ‘¥ ì¸ì› ëª…ë¶€ ê´€ë¦¬</h2>
                    <a href="{% url 'core:personnel_add' %}" class="btn-green">+ ì¸ì› ê°œë³„ ì¶”ê°€</a>
                </div>

                <form action="{% url 'core:assign_personnel_bulk' %}" method="post" style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
                    {% csrf_token %}

                    <div class="control-bar">
                        <div class="bulk-action">
                            <strong>ì„ íƒí•œ ì¸ì›ì„:</strong>
                            <span style="font-size:1.5em;">ğŸ‘‰</span>
                            <select name="standing_team_id" class="input-box" required>
                                <option value="">-- ì´ë™í•  íŒ€ ì„ íƒ --</option>
                                <option value="none">âŒ ì†Œì† í•´ì œ (íŒ€ì—ì„œ ë¹¼ê¸°)</option>
                                {% for team in standing_teams %}
                                <option value="{{ team.id }}">
                                    [{{ team.get_category_display }}] {{ team.name }}
                                </option>
                                {% endfor %}
                            </select>
                            <button class="btn-assign">ì´ë™ / ë°°ì •í•˜ê¸°</button>
                        </div>
                        <div style="color:#666; font-size:0.9em;">
                            * ì²´í¬ë°•ìŠ¤ë¡œ ì—¬ëŸ¬ ëª…ì„ ì„ íƒí•˜ì„¸ìš”.
                        </div>
                    </div>

                    <div style="flex:1; overflow-y:auto; border:1px solid #eee;">
                        <table>
                            <thead>
                                <tr>
                                    <th width="50"><input type="checkbox" onclick="toggleAll(this)"></th>
                                    <th>ì´ë¦„</th>
                                    <th>í˜„ì¬ ì†Œì† íŒ€</th>
                                    <th>ì§ê¸‰</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in personnel %}
                                <tr>
                                    <td><input type="checkbox" name="person_ids" value="{{ p.id }}"></td>
                                    <td><strong>{{ p.name }}</strong></td>
                                    <td>
                                        {% if p.standing_team %}
                                            <span style="color:#1976d2; font-weight:bold;">{{ p.standing_team.name }}</span>
                                        {% else %}
                                            <span style="color:#ccc;">(ë¬´ì†Œì†)</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ p.default_role }}</td>
                                    <td>
                                        <a href="{% url 'core:personnel_edit' p.pk %}" style="text-decoration:none; color:#555;">ìˆ˜ì •</a>
                                        <span style="color:#ddd;">|</span>
                                        <a href="{% url 'core:personnel_delete' p.pk %}" onclick="return confirm('ì •ë§ ì‚­ì œí•©ë‹ˆê¹Œ?')" style="text-decoration:none; color:red;">ì‚­ì œ</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </form>
                </div>
        </div>
    </div>
</body>
</html>